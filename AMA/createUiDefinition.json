{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
		"config": {
            "isWizard": false,
            "basics": {
                "resourceGroup": {
                    "visible": false,
                    "label": "Resource Group",
                    "required": false
                }
            }   
        },
        "basics": [            
            {
                "name": "solutionName",
                "type": "Microsoft.Common.TextBox",
                "label": "Solution Name",
				"toolTip": "Different azure resources will be created using this solution name as prefix.",
                "defaultValue": "MyElsaviesSolution",
                "constraints": {
                    "required": true,
					"regex": "^[a-z0-9A-Z]{1,30}$",
                    "validationMessage": "Only alphanumeric characters are allowed, and the value must be 1-30 characters long."
                }
            },
			{
                "name": "domain",
                "type": "Microsoft.Common.TextBox",
                "label": "Domain",
				"toolTip": "Domain used for your solution services.",
                "defaultValue": "example.com", 
                "constraints": {
                    "required": true,
                    "regex": "^[a-zA-Z0-9-]+\\.[a-zA-Z]{2,}$",
                    "validationMessage": "Please enter a valid domain."
                }              
            }
        ],
        "steps": [
            {
                "name": "aksSettings",
                "label": "Azure Kubernetes Service Settings",
                "elements": [
                    {
                        "name": "vmSection",
                        "type": "Microsoft.Common.Section",
                        "label": "Customize your VM",
                        "elements": [
                            {
                                "name": "vmSize",
                                "type": "Microsoft.Compute.SizeSelector",
                                "label": "Size",
                                "toolTip": "Virtual Machine Size for your kubernetes Cluster",
                                "recommendedSizes": [
                                    "Standard_D1",
                                    "Standard_D2",
                                    "Standard_D3",
                                    "Standard_B1s",
									"Standard_B2s"
                                ],
                                "options": {
                                    "hideDiskTypeFilter": false
                                },
                                "osPlatform": "Linux",
                                "count": 1,
                                "visible": true
                            },
                            {
                                "name": "vmCount",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Count",
                                "defaultValue": "1",
                                "toolTip": "Virtual Machines Count for your kubernetes Cluster",        
                                "visible": true,
                                "constraints": {
                                    "required": true,
					                "regex": "^[0-9]{1,3}$",
                                    "validationMessage": "Only numeric characters are allowed, and the value must be between 1 and 999."
                                }
                            }
                        ],
                        "visible": true
                    },
                    {
                        "name": "linuxAdminUsername",
                        "type": "Microsoft.Compute.UserNameTextBox",
                        "label": "Admin Username",
                        "defaultValue": "",
                        "toolTip": "Username for the administrator account on the AKS virtual machines.",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z]{1,30}$",
                            "validationMessage": "Only alphanumeric characters are allowed, and the value must be 1-30 characters long."
                        },
                        "osPlatform": "Linux",
                        "visible": true
                    },
                    {
                        "name": "sshRSAPublicKey",
                        "type": "Microsoft.Common.TextBox",
                        "label": "SSH RSA Public Key",
                        "defaultValue": "",
                        "toolTip": "SSH RSA Public Key for the administrator account on the AKS virtual machines.",        
                        "visible": true,
                        "constraints": {
                            "required": true,
                            "regex": "^ssh-rsa\\s+[A-Za-z0-9+/]+={0,3}(?:\\s+.+)?$",
                            "validationMessage": "Please enter a valid SSH RSA Public Key."
                        }
                    }
                ]
            },
            {
                "name": "storageSettings",
                "label": "Storage Settings",
                "elements": [
                    {
                        "name": "storageInfo",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Select the SKU for you storage accounts, two storages account will be created: one for general use, and, one for your machine learning workspace."
                        }
                    },
					{
                        "name": "storageSKU",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Storage SKU",
                        "placeholder": "Select a SKU",
                        "defaultValue": "Standard LRS",
                        "toolTip": "The SKU Name. Required for the storage accounts creation; optional for update. Note that in older versions, SKU name was called accountType.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Standard LRS",
                                    "value": "Standard_LRS"
                                },
                                {
                                    "label": "Premium LRS",
                                    "value": "Premium_LRS"
                                },
								{
                                    "label": "Standard ZRS",
                                    "value": "Standard_ZRS"
                                },
								{
                                    "label": "Premium ZRS",
                                    "value": "Premium_ZRS"
                                },
								{
                                    "label": "Standard GRS",
                                    "value": "Standard_GRS"
                                },
								{
                                    "label": "Standard GZRS",
                                    "value": "Standard_GZRS"
                                },
								{
                                    "label": "Standard RAGRS",
                                    "value": "Standard_RAGRS"
                                },
								{
                                    "label": "Standard RAGZRS",
                                    "value": "Standard_RAGZRS"
                                }
                            ],
                            "required": true
                        },
                        "visible": true
                    }
                ]
            },
            {
                "name": "sqlSettings",
                "label": "SQL Settings",
                "elements": [
                    {
                        "name": "sqlAdminUsername",
                        "type": "Microsoft.Common.TextBox",
                        "label": "SQL Admin Username",
                        "defaultValue": "",
                        "toolTip": "SQL Server administrator username.",        
                        "visible": true,
                        "constraints": {
                            "required": true,
                            "regex": "^[a-zA-Z][a-zA-Z0-9]{0,29}$",
                            "validationMessage": "Username must start with a letter and be 1-30 characters long, containing only letters and numbers."
                        }
                    },
                    {
                        "name": "sqlAdminPassword",
                        "type": "Microsoft.Common.PasswordBox",
                        "label": {
                            "password": "Password",
                            "confirmPassword": "Confirm password"
                        },
                        "toolTip": "SQL Server administrator password.",
                        "constraints": {
                            "required": true,
                            "regex": "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[^a-zA-Z\\d]).{12,128}$",
                            "validationMessage": "Password must be 8-128 characters and include uppercase, lowercase, number, and special character."
                        },
                        "options": {
                            "hideConfirmation": false
                        },
                        "visible": true
                    }
                ]
            }
        ],
        "outputs": {
            "solutionName": "[basics('solutionName')]",
            "domain": "[basics('domain')]",
            "Location": "[location()]",
            "managedResourceGroupName": "[resourceGroup().name]",
            "aksVMSize": "[steps('aksSettings').vmSection.vmSize]",
            "aksVMCount": "[int(steps('aksSettings').vmSection.vmCount)]",
            "linuxAdminUsername": "[steps('aksSettings').linuxAdminUsername]",
            "sshRSAPublicKey": "[steps('aksSettings').sshRSAPublicKey]",
            "storageSKU": "[steps('storageSettings').storageSKU]",
            "sqlAdminUsername": "[steps('sqlSettings').sqlAdminUsername]",
            "sqlAdminPassword": "[steps('sqlSettings').sqlAdminPassword]"
        }
    }
}